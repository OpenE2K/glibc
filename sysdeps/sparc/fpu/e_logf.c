/*
 * Copyright 12/10/02 Sun Microsystems, Inc.  All Rights Reserved.
 */
/*
 * float logf(float x);
 * Single precision log;
 * Table look-up algorithm
 * By K.C. Ng, Jan 18, 1989.
 *
 * Special cases:
 *	log(x) is NaN with signal if x < 0 (including -INF) ;
 *	log(+INF) is +INF; log(0) is -INF with signal;
 *	log(NaN) is that NaN with no signal.
 *
 * Constants:
 * The hexadecimal values are the intended ones for the following constants.
 * The decimal values may be used, provided that the compiler will convert
 * from decimal to binary accurately enough to produce the hexadecimal values
 * shown.
 */
/* Copyright (C) 2011-2014 Free Software Foundation, Inc.
   This file is part of the GNU C Library.
   Contributed by Ulrich Drepper <drepper@gmail.com>, 2011.

   The GNU C Library is free software; you can redistribute it and/or
   modify it under the terms of the GNU Lesser General Public
   License as published by the Free Software Foundation; either
   version 2.1 of the License, or (at your option) any later version.

   The GNU C Library is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
   Lesser General Public License for more details.

   You should have received a copy of the GNU Lesser General Public
   License along with the GNU C Library; if not, see
   <http://www.gnu.org/licenses/>.  */

#include <math.h>
#include <math_private.h>
#include <math-svid-compat.h>

const float _TBL_r_log_hi[] = {
-2.367123604e+00,-2.346504211e+00,-2.326301575e+00,-2.306499004e+00,
-2.287080765e+00,-2.268032551e+00,-2.249340534e+00,-2.230991364e+00,
-2.212972879e+00,-2.195273399e+00,-2.177881718e+00,-2.160787106e+00,
-2.143980026e+00,-2.127450705e+00,-2.111190319e+00,-2.095189810e+00,
-2.079441547e+00,-2.048669815e+00,-2.018816948e+00,-1.989829302e+00,
-1.961658478e+00,-1.934259415e+00,-1.907591343e+00,-1.881615758e+00,
-1.856297970e+00,-1.831605434e+00,-1.807507753e+00,-1.783977270e+00,
-1.760987759e+00,-1.738514900e+00,-1.716536045e+00,-1.695029736e+00,
-1.673976421e+00,-1.653357029e+00,-1.633154392e+00,-1.613351822e+00,
-1.593933702e+00,-1.574885488e+00,-1.556193352e+00,-1.537844181e+00,
-1.519825697e+00,-1.502126217e+00,-1.484734416e+00,-1.467639923e+00,
-1.450832844e+00,-1.434303522e+00,-1.418043017e+00,-1.402042627e+00,
-1.386294365e+00,-1.355522633e+00,-1.325669765e+00,-1.296682119e+00,
-1.268511295e+00,-1.241112232e+00,-1.214444160e+00,-1.188468575e+00,
-1.163150787e+00,-1.138458252e+00,-1.114360571e+00,-1.090830088e+00,
-1.067840576e+00,-1.045367718e+00,-1.023388863e+00,-1.001882553e+00,
-9.808292389e-01,-9.602099657e-01,-9.400072694e-01,-9.202046394e-01,
-9.007865191e-01,-8.817383647e-01,-8.630462289e-01,-8.446970582e-01,
-8.266785741e-01,-8.089789748e-01,-7.915872335e-01,-7.744928002e-01,
-7.576857209e-01,-7.411563993e-01,-7.248958945e-01,-7.088955641e-01,
-6.931471825e-01,-6.623755097e-01,-6.325225830e-01,-6.035349965e-01,
-5.753641725e-01,-5.479651690e-01,-5.212969184e-01,-4.953214228e-01,
-4.700036347e-01,-4.453110099e-01,-4.212134778e-01,-3.976829648e-01,
-3.746934533e-01,-3.522205949e-01,-3.302416801e-01,-3.087354898e-01,
-2.876820862e-01,-2.670627832e-01,-2.468600720e-01,-2.270574570e-01,
-2.076393664e-01,-1.885911673e-01,-1.698990315e-01,-1.515499055e-01,
-1.335313916e-01,-1.158318147e-01,-9.844007343e-02,-8.134564012e-02,
-6.453852355e-02,-4.800922051e-02,-3.174869716e-02,-1.574835740e-02,
 0.000000000e+00, 3.077165782e-02, 6.062462181e-02, 8.961215615e-02,
 1.177830324e-01, 1.451820135e-01, 1.718502641e-01, 1.978257447e-01,
 2.231435478e-01, 2.478361577e-01, 2.719337046e-01, 2.954642177e-01,
 3.184537292e-01, 3.409265876e-01, 3.629055023e-01, 3.844116926e-01,
 4.054650962e-01, 4.260843992e-01, 4.462870955e-01, 4.660897255e-01,
 4.855078161e-01, 5.045560002e-01, 5.232481360e-01, 5.415973067e-01,
 5.596157908e-01, 5.773153901e-01, 5.947071314e-01, 6.118015647e-01,
 6.286086440e-01, 6.451379657e-01, 6.613984704e-01, 6.773988008e-01,
 6.931471825e-01, 7.239188552e-01, 7.537717819e-01, 7.827593684e-01,
 8.109301925e-01, 8.383291960e-01, 8.649974465e-01, 8.909729123e-01,
 9.162907600e-01, 9.409833550e-01, 9.650809169e-01, 9.886114001e-01,
 1.011600971e+00, 1.034073710e+00, 1.056052685e+00, 1.077558875e+00,
 1.098612309e+00, 1.119231462e+00, 1.139434338e+00, 1.159236908e+00,
 1.178654909e+00, 1.197703123e+00, 1.216395378e+00, 1.234744430e+00,
 1.252762914e+00, 1.270462513e+00, 1.287854195e+00, 1.304948688e+00,
 1.321755886e+00, 1.338285089e+00, 1.354545593e+00, 1.370545983e+00,
 1.386294365e+00, 1.417065978e+00, 1.446918964e+00, 1.475906491e+00,
 1.504077435e+00, 1.531476259e+00, 1.558144569e+00, 1.584120035e+00,
 1.609437943e+00, 1.634130478e+00, 1.658228040e+00, 1.681758523e+00,
 1.704748034e+00, 1.727220893e+00, 1.749199867e+00, 1.770706058e+00,
 1.791759491e+00, 1.812378645e+00, 1.832581520e+00, 1.852384090e+00,
 1.871802092e+00, 1.890850306e+00, 1.909542561e+00, 1.927891612e+00,
 1.945910096e+00, 1.963609695e+00, 1.981001377e+00, 1.998095870e+00,
 2.014903069e+00, 2.031432152e+00, 2.047692776e+00, 2.063693047e+00,
 2.079441547e+00, 2.110213280e+00, 2.140066147e+00, 2.169053555e+00,
 2.197224617e+00, 2.224623442e+00, 2.251291752e+00, 2.277267218e+00,
 2.302585125e+00, 2.327277660e+00, 2.351375103e+00, 2.374905586e+00,
 2.397895336e+00, 2.420368195e+00, 2.442347050e+00, 2.463853359e+00,
 2.484906673e+00, 2.505525827e+00, 2.525728703e+00, 2.545531273e+00,
 2.564949274e+00, 2.583997488e+00, 2.602689743e+00, 2.621038914e+00,
 2.639057159e+00, 2.656756878e+00, 2.674148560e+00, 2.691243172e+00,
 2.708050251e+00, 2.724579334e+00, 2.740839958e+00, 2.756840229e+00,
 2.772588730e+00, 2.803360462e+00, 2.833213329e+00, 2.862200737e+00,
 2.890371799e+00, 2.917770624e+00, 2.944438934e+00, 2.970414400e+00,
 2.995732307e+00, 3.020424843e+00, 3.044522285e+00, 3.068052769e+00,
 3.091042519e+00, 3.113515377e+00, 3.135494232e+00, 3.157000303e+00,
};

const float _TBL_r_log_lo[] = {
-1.031081620e-08,-1.155030986e-07,-4.490432914e-08, 1.204883127e-08,
-1.416875648e-07,-1.606756115e-07,-4.426502898e-08,-7.628164411e-08,
-5.489456711e-08, 4.214806992e-08, 1.031887962e-07,-7.557348169e-08,
-3.657228831e-08,-5.629161137e-08, 7.906686506e-08,-8.884877900e-08,
 5.713963080e-09,-6.794959972e-08, 2.807361099e-08,-8.115604544e-08,
-2.824024925e-08,-1.171624859e-07, 5.817284787e-08,-4.040771628e-08,
-2.054751036e-08, 5.664247027e-08,-7.282400105e-08,-5.865965846e-08,
-5.192482533e-08,-5.450172225e-08,-2.916004549e-09,-1.072043148e-07,
-1.221547041e-08,-1.174077511e-07,-4.680898513e-08, 1.014417705e-08,
-2.438293656e-08,-4.337098147e-08,-4.616968141e-08,-7.818630365e-08,
-5.679922310e-08, 4.024341393e-08,-1.792514759e-08,-7.747813413e-08,
-3.847694430e-08,-5.819626736e-08,-4.204708048e-08,-9.075343144e-08,
 3.809308424e-09,-6.985425927e-08, 2.616895678e-08,-8.306069788e-08,
-3.014490346e-08,-1.190671384e-07, 5.626819544e-08,-4.231237227e-08,
-2.245216457e-08, 5.473781428e-08,-7.472865349e-08,-6.056431090e-08,
-5.382948132e-08,-5.640637823e-08,-4.820658983e-09,-1.091089672e-07,
-1.412012463e-08,-1.031189717e-10, 1.089100543e-08, 8.239522842e-09,
-2.628759255e-08, 1.432900731e-08, 1.153030826e-08,-2.048630954e-08,
 9.007676827e-10,-2.126588328e-08,-1.982980180e-08,-1.977814890e-08,
 1.922304627e-08,-4.962754097e-10, 1.565291008e-08, 2.655120035e-08,
 1.904654212e-09,-1.215426959e-08, 2.426430257e-08,-2.536070554e-08,
 2.755508710e-08,-1.762505475e-09,-5.241104883e-09,-1.441470232e-08,
 5.445502715e-09,-6.771483374e-09, 1.277365680e-08,-2.864321003e-09,
 3.870509691e-09, 1.293612995e-09,-6.725313195e-09, 8.195662815e-09,
 1.377754355e-08,-2.007773281e-09,-5.914809975e-09, 6.334868630e-09,
 1.610076406e-09,-2.476808092e-09,-5.275507586e-09, 7.411358194e-09,
-1.003886640e-09,-8.187961975e-10, 6.172856670e-10, 6.689380716e-10,
 2.417230860e-09, 1.324360621e-09,-1.152905771e-09, 4.321589475e-10,
 0.000000000e+00, 8.422373909e-10, 7.905942394e-12, 2.536961974e-09,
 3.298690654e-09,-3.667159909e-09,-7.145759096e-09,-1.418195672e-09,
 3.540848503e-09, 6.225023608e-09, 1.086900259e-08,-4.768975437e-09,
 1.965855256e-09,-6.110413286e-10,-8.629967851e-09, 6.291008159e-09,
 1.187288934e-08,-3.912427715e-09, 7.081697007e-09, 4.430214418e-09,
-2.945778899e-10, 1.051969889e-08, 7.720998951e-09,-2.429561796e-08,
-2.908540964e-09,-2.507519170e-08,-2.363911022e-08,-2.358745732e-08,
 1.541373784e-08,-4.305583889e-09, 1.184360077e-08, 2.274189193e-08,
-1.904654212e-09,-1.596357890e-08, 2.045499414e-08,-2.917001396e-08,
 2.374577868e-08,-5.571814121e-09,-9.050412864e-09, 1.157831164e-08,
-2.816612898e-08,-1.058079224e-08,-2.083797490e-08,-6.673629649e-09,
-5.954344218e-08, 5.708895046e-08,-1.053462206e-08, 4.386353947e-09,
-1.983408815e-08, 1.133922041e-07,-5.442760198e-08, 2.525560205e-09,
 8.720773792e-08, 6.821969123e-08,-5.378829826e-08, 3.340437260e-08,
 5.479144960e-08, 3.262479709e-08, 9.366551978e-08, 3.411253147e-08,
-4.609556115e-08, 5.339440534e-08, 6.954358867e-08, 2.083723771e-08,
-3.809308424e-09, 4.173641344e-08, 1.855033993e-08, 2.852997483e-08,
-3.776352031e-08, 1.117328168e-07, 4.864957859e-08, 6.927830043e-08,
-3.007078320e-08, 4.711919743e-08, 3.686201566e-08, 5.102636180e-08,
 5.776119139e-08, 5.518429447e-08,-1.243927628e-08, 2.481699735e-09,
-2.173874236e-08, 1.114875516e-07,-5.633225797e-08, 6.209058823e-10,
 8.530307838e-08, 6.631503169e-08,-5.569295425e-08, 3.149971661e-08,
 5.288679361e-08, 3.072014465e-08, 9.176086735e-08, 3.220787903e-08,
-4.800021713e-08, 1.706990389e-07, 6.763893623e-08, 1.381418713e-07,
-5.713963080e-09,-7.937752855e-08, 1.664568572e-08, 1.458346048e-07,
-3.966817630e-08, 1.098281643e-07, 4.674492260e-08, 6.737364799e-08,
-3.197543563e-08, 4.521454500e-08, 1.541666563e-07, 1.683309989e-07,
-6.335275060e-08,-6.592964752e-08,-1.434393049e-08,-1.186322436e-07,
-2.364339657e-08, 1.095828992e-07,-5.823691041e-08,-1.283748441e-09,
 8.339842594e-08, 6.441037925e-08,-5.759760668e-08,-8.961422537e-08,
 1.701914272e-07, 2.881549044e-08, 8.985621491e-08,-8.890606296e-08,
-4.990486957e-08, 1.687943865e-07, 6.573428379e-08, 1.362372188e-07,
-7.618616849e-09,-8.128218099e-08, 1.474103062e-08, 1.439299524e-07,
-4.157282874e-08, 1.079235119e-07, 4.484027016e-08, 6.546899556e-08,
-3.388009162e-08, 4.330988901e-08, 1.522620039e-07, 1.664263323e-07,
-6.525741014e-08,-6.783429995e-08,-1.624858470e-08, 1.178816831e-07,
};

static const float
	zero	=   0.0F,
	one	=   1.0F,
	two	=   2.0F,
	two24   =   16777216.0F,
	ln2hi	=   6.931457519531250e-1F,   /* 0x3fe17200 */
	ln2lo	=   1.428606820286227e-6F,   /* 0x35bfbe8e */
	Bp1	=  -4.999996375804685823573958549562299962948e-0001F,
	Bp2	=   3.332876052778867563867062788080136631742e-0001F,
	Bp3	=  -2.481956765240820685943090256285822729909e-0001F,
	Bp4	=   1.714558145040048040035004076793152347174e-0001F,
	Bn1	=  -4.999994759413434573585341492223685712068e-0001F,
	Bn2	=   3.333975294998482570262574626287250035353e-0001F,
	Bn3	=  -2.475706542840484266818244545672477946459e-0001F,
	Bn4	=   2.355982881354679546528538019239950233010e-0001F,
	A1	=   6.667515563167808670229962750219736640405e-0001F;

static const float TBL[] = {
	0.000000000e+0F, 3.077165782e-2F, 6.062462181e-2F, 8.961215615e-2F,
	1.177830324e-1F, 1.451820135e-1F, 1.718502641e-1F, 1.978257447e-1F,
	2.231435478e-1F, 2.478361577e-1F, 2.719337046e-1F, 2.954642177e-1F,
	3.184537292e-1F, 3.409265876e-1F, 3.629055023e-1F, 3.844116926e-1F,
	4.054650962e-1F, 4.260843992e-1F, 4.462870955e-1F, 4.660897255e-1F,
	4.855078161e-1F, 5.045560002e-1F, 5.232481360e-1F, 5.415973067e-1F,
	5.596157908e-1F, 5.773153901e-1F, 5.947071314e-1F, 6.118015647e-1F,
	6.286086440e-1F, 6.451379657e-1F, 6.613984704e-1F, 6.773988008e-1F,
};

float
__logf(float x) {
	float fx, f, s, z, fn;
	int *px = (int *) &fx;
	int *pz = (int *) &z;
	int i, j, ix, n;

	n = 0;
	fx = x;
	ix = *((int *) &x);
	if (ix >= 0x3f6c0000) {	/* if x >= 1-0.078125 */
		if (ix < 0x3f8a0000) {	/* if x < 1+0.078125 */
			f = fx - one;
			if (ix == 0x3f800000)
				return (zero);
					z = f * f;
			if (ix > 0x3f800000) {
				if (ix < 0x3f804000) {
					if (ix < 0x3f800400)
							/* 0 < f < 2**-13 */
						fx = f + z * Bp1;
					else	/* 0 < f < 2**-9  */
						fx = f + z * (Bp1 + f * Bp2);
				} else
					fx = f + z * (Bp1 + f * (Bp2 +
						f * (Bp3 + f * Bp4)));
			} else {
				if (ix > 0x3f7f8000) {
					if (ix > 0x3f7ff800)
							/* -2**-13 < f < 0 */
						fx = f + z * Bn1;
					else	/* -2**-9  < f < 0 */
						fx = f + z * (Bn1 + f * Bn2);
				} else
					fx = f + z * (Bn1 + f * (Bn2 +
						f * (Bn3 + f * Bn4)));
			}
			return (fx);
		}
		if (ix >= 0x41bc0000) {
			if (ix >= 0x7f800000) {
				/* x is +inf or NaN */
				return (fx * fx);	/* + -> * for Cheetah */
			}
			goto LARGE_N;
		}
		goto SMALL_N;
	}
	if (ix >= 0x3dc00000)
		goto SMALL_N;
	if (ix >= 0x00800000)
		goto LARGE_N;
	i = ix & 0x7fffffff;
	if (i == 0) {		/* log(0)= -inf */
		return __kernel_standard_f(x, x, 116);
	}
	if (ix < 0) {
		if (ix > (int) 0xff800000)
			fx -= fx;	/* x is -NaN */
		else
			fx = __kernel_standard_f(x, x, 117);	/* log(x<0) is NaN  */
		return (fx);
	}
	/* subnormal x */
	fx *= two24;
	n = -24;
	ix = px[0];
LARGE_N:
	n += ((ix + 0x20000) >> 23) - 0x7f;
	ix = (ix & 0x007fffff) | 0x3f800000;	/* scale x to [1,2] */
	px[0] = ix;
	i = ix + 0x20000;
	pz[0] = i & 0xfffc0000;
	s = (fx - z) / (fx + z);
	j = (i >> 18) & 0x1f;
	z = s * s;
	fn = (float) n;
	f = fn * ln2lo + s * (two + z * A1);
	f += TBL[j];
	fx = fn * ln2hi + f;
	return (fx);
SMALL_N:
	pz[0] = (ix + 0x20000) & 0xfffc0000;
	s = (fx - z) / (fx + z);
	j = (ix - 0x3dbe0000) >> 18;	/* combine -(0x20000-0x3dc00000) */
	z = s * s;
	f = _TBL_r_log_lo[j] + s * (two + z * A1);
	fx = _TBL_r_log_hi[j] + f;
	return (fx);
}

strong_alias (__logf, __logf_finite)
weak_alias (__logf, logf)
weak_alias (__logf, __ieee754_logf)
